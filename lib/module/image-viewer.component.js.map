{"version":3,"sources":["image-viewer.component.tsx"],"names":["React","Animated","CameraRoll","I18nManager","Image","Text","TouchableHighlight","TouchableOpacity","TouchableWithoutFeedback","View","ImageZoom","styles","Props","State","ImageViewer","Component","Value","Map","index","imageRefs","reset","state","imageSizes","length","loadImage","offsetX","positionXNumber","standardPositionX","positionX","setValue","offsetXRTL","isRTL","currentShowIndex","props","imageUrls","vx","vxRTL","isLeftMove","flipThreshold","isRightMove","goBack","call","goNext","resetPosition","width","timing","toValue","duration","pageAnimateTime","useNativeDriver","start","nextIndex","setState","onChange","image","saveToLocalByLongPress","isShowMenu","onLongPress","onClick","handleCancel","onDoubleClick","hasLayout","onCancel","event","nativeEvent","layout","height","style","backgroundColor","forceUpdate","jumpToCurrentImage","onSave","saveToCameraRoll","url","onSaveToCamera","onSwipeDown","componentDidMount","init","getDerivedStateFromProps","nextProps","prevState","prevIndexProp","componentDidUpdate","prevProps","fadeAnim","reloadAllLoadedImage","Array","from","loadedIndex","keys","imageStatus","saveImageSizeRegardlessImageState","slice","getSize","status","data","resolveAssetSource","source","newError","forEach","imageUrl","push","has","set","saveImageSize","imageLoaded","startsWith","enablePreload","prefetch","getContent","screenWidth","screenHeight","ImageElements","map","handleLongPressWithIndex","handleLongPress","bind","imageInfo","widthPixel","HeightPixel","Wrapper","children","others","maxOverflow","handleHorizontalOuterRangeOffset","handleResponderRelease","onMove","get","handleClick","handleDoubleClick","enableSwipeDown","swipeDownThreshold","handleSwipeDown","enableImageZoom","doubleClickInterval","modalContainer","loadingContainer","loadingRender","imageStyle","uri","preloadImage","el","minScale","maxScale","renderImage","failImageSource","zIndex","container","opacity","renderHeader","arrowLeftContainer","renderArrowLeft","arrowRightContainer","renderArrowRight","moveBox","transform","translateX","renderIndicator","originSizeKb","originUrl","watchOrigin","watchOriginTouchable","watchOriginText","bottom","position","footerContainerStyle","renderFooter","getMenu","menus","menuContainer","cancel","handleLeaveMenu","saveToLocal","menuShadow","menuContent","operateContainer","operateText","menuContext","render","childs","flex","handleLayout","overflow"],"mappings":"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","sourcesContent":["import * as React from 'react';\n\nimport {\n  Animated,\n  CameraRoll,\n  I18nManager,\n  Image,\n  Text,\n  TouchableHighlight,\n  TouchableOpacity,\n  TouchableWithoutFeedback,\n  View,\n} from 'react-native';\nimport ImageZoom from 'react-native-image-pan-zoom';\nimport styles from './image-viewer.style';\nimport { IImageInfo, IImageSize, Props, State } from './image-viewer.type';\n\nexport default class ImageViewer extends React.Component<Props, State> {\n  public static defaultProps = new Props();\n  public state = new State();\n\n  // 背景透明度渐变动画\n  private fadeAnim = new Animated.Value(0);\n\n  // 当前基准位置\n  private standardPositionX = 0;\n\n  // 整体位移，用来切换图片用\n  private positionXNumber = 0;\n  private positionX = new Animated.Value(0);\n\n  private width = 0;\n  private height = 0;\n\n  private styles = styles(0, 0, 'transparent');\n\n  // 是否执行过 layout. fix 安卓不断触发 onLayout 的 bug\n  // @ts-ignore\n  private hasLayout = false;\n\n  // 记录已加载的图片 index\n  private loadedIndex = new Map<number, boolean>();\n\n  private handleLongPressWithIndex = new Map<number, any>();\n\n  private imageRefs: any[] = [];\n\n  public componentDidMount() {\n    this.init(this.props);\n  }\n\n  static getDerivedStateFromProps(nextProps: Props, prevState: State) {\n    if (nextProps.index !== prevState.prevIndexProp) {\n      return {\n        currentShowIndex: nextProps.index,\n        prevIndexProp: nextProps.index,\n      };\n    }\n    return null;\n  }\n\n  public componentDidUpdate(prevProps: Props) {\n    if (prevProps.index !== this.props.index) {\n      // 立刻预加载要看的图\n      this.loadImage(this.props.index || 0);\n\n      this.jumpToCurrentImage();\n\n      // 显示动画\n      Animated.timing(this.fadeAnim, {\n        toValue: 1,\n        duration: 200,\n        useNativeDriver: !!this.props.useNativeDriver,\n      }).start();\n    }\n  }\n\n  public reloadAllLoadedImage() {\n    for (let index of Array.from(this.loadedIndex.keys())) {\n      const image = this.props.imageUrls[index];\n      const imageStatus = { ...this!.state!.imageSizes![index] };\n\n      // 保存 imageSize 不管当前是否已经加载成功\n      const saveImageSizeRegardlessImageState = () => {\n        const imageSizes = this!.state!.imageSizes!.slice();\n        imageSizes[index] = imageStatus;\n        this.setState({ imageSizes });\n      };\n      Image.getSize(\n        image.url,\n        (width: number, height: number) => {\n          imageStatus.width = width;\n          imageStatus.height = height;\n          imageStatus.status = 'success';\n          saveImageSizeRegardlessImageState();\n        },\n        () => {\n          try {\n            const data = (Image as any).resolveAssetSource(image.props.source);\n            imageStatus.width = data.width;\n            imageStatus.height = data.height;\n            imageStatus.status = 'success';\n            saveImageSizeRegardlessImageState();\n          } catch (newError) {\n            // Give up..\n            imageStatus.status = 'fail';\n            saveImageSizeRegardlessImageState();\n          }\n        },\n      );\n    }\n  }\n\n  /**\n   * props 有变化时执行\n   */\n  public init(nextProps: Props) {\n    if (nextProps.imageUrls.length === 0) {\n      // 隐藏时候清空\n      this.fadeAnim.setValue(0);\n      return this.setState(new State());\n    }\n\n    // 给 imageSizes 塞入空数组\n    const imageSizes: IImageSize[] = [];\n    nextProps.imageUrls.forEach((imageUrl) => {\n      imageSizes.push({\n        width: imageUrl.width || 0,\n        height: imageUrl.height || 0,\n        status: 'loading',\n      });\n    });\n\n    this.setState(\n      {\n        currentShowIndex: nextProps.index,\n        prevIndexProp: nextProps.index || 0,\n        imageSizes,\n      },\n      () => {\n        // 立刻预加载要看的图\n        this.loadImage(nextProps.index || 0);\n\n        this.jumpToCurrentImage();\n\n        // 显示动画\n        Animated.timing(this.fadeAnim, {\n          toValue: 1,\n          duration: 200,\n          useNativeDriver: !!nextProps.useNativeDriver,\n        }).start();\n      },\n    );\n  }\n\n  /**\n   * reset Image scale and position\n   */\n  public resetImageByIndex = (index: number) => {\n    this.imageRefs[index] && this.imageRefs[index].reset();\n  };\n\n  /**\n   * 调到当前看图位置\n   */\n  public jumpToCurrentImage() {\n    // 跳到当前图的位置\n    this.positionXNumber =\n      this.width *\n      (this.state.currentShowIndex || 0) *\n      (I18nManager.isRTL ? 1 : -1);\n    this.standardPositionX = this.positionXNumber;\n    this.positionX.setValue(this.positionXNumber);\n  }\n\n  /**\n   * 加载图片，主要是获取图片长与宽\n   */\n  public loadImage(index: number) {\n    if (!this!.state!.imageSizes![index]) {\n      return;\n    }\n\n    if (this.loadedIndex.has(index)) {\n      return;\n    }\n    this.loadedIndex.set(index, true);\n\n    const image = this.props.imageUrls[index];\n    const imageStatus = { ...this!.state!.imageSizes![index] };\n\n    // 保存 imageSize\n    const saveImageSize = () => {\n      // 如果已经 success 了，就不做处理\n      if (\n        this!.state!.imageSizes![index] &&\n        this!.state!.imageSizes![index].status !== 'loading'\n      ) {\n        return;\n      }\n\n      const imageSizes = this!.state!.imageSizes!.slice();\n      imageSizes[index] = imageStatus;\n      this.setState({ imageSizes });\n    };\n\n    if (this!.state!.imageSizes![index].status === 'success') {\n      // 已经加载过就不会加载了\n      return;\n    }\n\n    // 如果已经有宽高了，直接设置为 success\n    if (\n      this!.state!.imageSizes![index].width > 0 &&\n      this!.state!.imageSizes![index].height > 0\n    ) {\n      imageStatus.status = 'success';\n      saveImageSize();\n      return;\n    }\n\n    // 是否加载完毕了图片大小\n    // const sizeLoaded = false;\n    // 是否加载完毕了图片\n    let imageLoaded = false;\n\n    // Tagged success if url is started with file:, or not set yet(for custom source.uri).\n    if (!image.url || image.url.startsWith(`file:`)) {\n      imageLoaded = true;\n    }\n\n    // 如果已知源图片宽高，直接设置为 success\n    if (image.width && image.height) {\n      if (this.props.enablePreload && imageLoaded === false) {\n        Image.prefetch(image.url);\n      }\n      imageStatus.width = image.width;\n      imageStatus.height = image.height;\n      imageStatus.status = 'success';\n      saveImageSize();\n      return;\n    }\n\n    Image.getSize(\n      image.url,\n      (width: number, height: number) => {\n        imageStatus.width = width;\n        imageStatus.height = height;\n        imageStatus.status = 'success';\n        saveImageSize();\n      },\n      () => {\n        try {\n          const data = (Image as any).resolveAssetSource(image.props.source);\n          imageStatus.width = data.width;\n          imageStatus.height = data.height;\n          imageStatus.status = 'success';\n          saveImageSize();\n        } catch (newError) {\n          // Give up..\n          imageStatus.status = 'fail';\n          saveImageSize();\n        }\n      },\n    );\n  }\n\n  /**\n   * 预加载图片\n   */\n  public preloadImage = (index: number) => {\n    if (index < this.state.imageSizes!.length) {\n      this.loadImage(index + 1);\n    }\n  };\n  /**\n   * 触发溢出水平滚动\n   */\n  public handleHorizontalOuterRangeOffset = (offsetX: number = 0) => {\n    this.positionXNumber = this.standardPositionX + offsetX;\n    this.positionX.setValue(this.positionXNumber);\n\n    const offsetXRTL = !I18nManager.isRTL ? offsetX : -offsetX;\n\n    if (offsetXRTL < 0) {\n      if (\n        this!.state!.currentShowIndex ||\n        0 < this.props.imageUrls.length - 1\n      ) {\n        this.loadImage((this!.state!.currentShowIndex || 0) + 1);\n      }\n    } else if (offsetXRTL > 0) {\n      if (this!.state!.currentShowIndex || 0 > 0) {\n        this.loadImage((this!.state!.currentShowIndex || 0) - 1);\n      }\n    }\n  };\n\n  /**\n   * 手势结束，但是没有取消浏览大图\n   */\n  public handleResponderRelease = (vx: number = 0) => {\n    const vxRTL = I18nManager.isRTL ? -vx : vx;\n    const isLeftMove = I18nManager.isRTL\n      ? this.positionXNumber - this.standardPositionX <\n      -(this.props.flipThreshold || 0)\n      : this.positionXNumber - this.standardPositionX >\n      (this.props.flipThreshold || 0);\n    const isRightMove = I18nManager.isRTL\n      ? this.positionXNumber - this.standardPositionX >\n      (this.props.flipThreshold || 0)\n      : this.positionXNumber - this.standardPositionX <\n      -(this.props.flipThreshold || 0);\n\n    if (vxRTL > 0.7) {\n      // 上一张\n      this.goBack.call(this);\n\n      // 这里可能没有触发溢出滚动，为了防止图片不被加载，调用加载图片\n      if (this.state.currentShowIndex || 0 > 0) {\n        this.loadImage((this.state.currentShowIndex || 0) - 1);\n      }\n      return;\n    } else if (vxRTL < -0.7) {\n      // 下一张\n      this.goNext.call(this);\n      if (this.state.currentShowIndex || 0 < this.props.imageUrls.length - 1) {\n        this.loadImage((this.state.currentShowIndex || 0) + 1);\n      }\n      return;\n    }\n\n    if (isLeftMove) {\n      // 上一张\n      this.goBack.call(this);\n    } else if (isRightMove) {\n      // 下一张\n      this.goNext.call(this);\n      return;\n    } else {\n      // 回到之前的位置\n      this.resetPosition.call(this);\n      return;\n    }\n  };\n\n  /**\n   * 到上一张\n   */\n  public goBack = () => {\n    if (this.state.currentShowIndex === 0) {\n      // 回到之前的位置\n      this.resetPosition.call(this);\n      return;\n    }\n\n    this.positionXNumber = !I18nManager.isRTL\n      ? this.standardPositionX + this.width\n      : this.standardPositionX - this.width;\n    this.standardPositionX = this.positionXNumber;\n    Animated.timing(this.positionX, {\n      toValue: this.positionXNumber,\n      duration: this.props.pageAnimateTime,\n      useNativeDriver: !!this.props.useNativeDriver,\n    }).start();\n\n    const nextIndex = (this.state.currentShowIndex || 0) - 1;\n\n    this.setState(\n      {\n        currentShowIndex: nextIndex,\n      },\n      () => {\n        if (this.props.onChange) {\n          this.props.onChange(this.state.currentShowIndex);\n        }\n      },\n    );\n  };\n\n  /**\n   * 到下一张\n   */\n  public goNext = () => {\n    if (this.state.currentShowIndex === this.props.imageUrls.length - 1) {\n      // 回到之前的位置\n      this.resetPosition.call(this);\n      return;\n    }\n\n    this.positionXNumber = !I18nManager.isRTL\n      ? this.standardPositionX - this.width\n      : this.standardPositionX + this.width;\n    this.standardPositionX = this.positionXNumber;\n    Animated.timing(this.positionX, {\n      toValue: this.positionXNumber,\n      duration: this.props.pageAnimateTime,\n      useNativeDriver: !!this.props.useNativeDriver,\n    }).start();\n\n    const nextIndex = (this.state.currentShowIndex || 0) + 1;\n\n    this.setState(\n      {\n        currentShowIndex: nextIndex,\n      },\n      () => {\n        if (this.props.onChange) {\n          this.props.onChange(this.state.currentShowIndex);\n        }\n      },\n    );\n  };\n\n  /**\n   * 回到原位\n   */\n  public resetPosition() {\n    this.positionXNumber = this.standardPositionX;\n    Animated.timing(this.positionX, {\n      toValue: this.standardPositionX,\n      duration: 150,\n      useNativeDriver: !!this.props.useNativeDriver,\n    }).start();\n  }\n\n  /**\n   * 长按\n   */\n  public handleLongPress = (image: IImageInfo) => {\n    if (this.props.saveToLocalByLongPress) {\n      // 出现保存到本地的操作框\n      this.setState({ isShowMenu: true });\n    }\n\n    if (this.props.onLongPress) {\n      this.props.onLongPress(image);\n    }\n  };\n\n  /**\n   * 单击\n   */\n  public handleClick = () => {\n    if (this.props.onClick) {\n      this.props.onClick(this.handleCancel, this.state.currentShowIndex);\n    }\n  };\n\n  /**\n   * 双击\n   */\n  public handleDoubleClick = () => {\n    if (this.props.onDoubleClick) {\n      this.props.onDoubleClick(this.handleCancel);\n    }\n  };\n\n  /**\n   * 退出\n   */\n  public handleCancel = () => {\n    this.hasLayout = false;\n    if (this.props.onCancel) {\n      this.props.onCancel();\n    }\n  };\n\n  /**\n   * 完成布局\n   */\n  public handleLayout = (event: any) => {\n    if (event.nativeEvent.layout.width !== this.width) {\n      this.hasLayout = true;\n\n      this.width = event.nativeEvent.layout.width;\n      //there use passed height fix bug (height not fill screen height)\n      this.height = this.props.style!.height as number;\n      this.styles = styles(\n        this.width,\n        this.height,\n        this.props.backgroundColor || 'transparent',\n      );\n\n      // 强制刷新\n      this.forceUpdate();\n      this.jumpToCurrentImage();\n    }\n  };\n\n  /**\n   * 获得整体内容\n   */\n  public getContent() {\n    // 获得屏幕宽高\n    const screenWidth = this.width;\n    const screenHeight = this.height;\n\n    const ImageElements = this.props.imageUrls.map((image, index) => {\n      if (\n        (this.state.currentShowIndex || 0) > index + 1 ||\n        (this.state.currentShowIndex || 0) < index - 1\n      ) {\n        return (\n          <View\n            key={index}\n            style={{ width: screenWidth, height: screenHeight }}\n          />\n        );\n      }\n\n      if (!this.handleLongPressWithIndex.has(index)) {\n        this.handleLongPressWithIndex.set(\n          index,\n          this.handleLongPress.bind(this, image),\n        );\n      }\n\n      let width =\n        this!.state!.imageSizes![index] &&\n        this!.state!.imageSizes![index].width;\n      let height =\n        this.state.imageSizes![index] && this.state.imageSizes![index].height;\n      const imageInfo = this.state.imageSizes![index];\n\n      if (!imageInfo || !imageInfo.status) {\n        return (\n          <View\n            key={index}\n            style={{ width: screenWidth, height: screenHeight }}\n          />\n        );\n      }\n\n      // 如果宽大于屏幕宽度,整体缩放到宽度是屏幕宽度\n      if (width > screenWidth) {\n        const widthPixel = screenWidth / width;\n        width *= widthPixel;\n        height *= widthPixel;\n      }\n\n      // 如果此时高度还大于屏幕高度,整体缩放到高度是屏幕高度\n      if (height > screenHeight) {\n        const HeightPixel = screenHeight / height;\n        width *= HeightPixel;\n        height *= HeightPixel;\n      }\n\n      const Wrapper = ({ children, ...others }: any) => (\n        <ImageZoom\n          cropWidth={this.width}\n          cropHeight={this.height}\n          maxOverflow={this.props.maxOverflow}\n          horizontalOuterRangeOffset={this.handleHorizontalOuterRangeOffset}\n          responderRelease={this.handleResponderRelease}\n          onMove={this.props.onMove}\n          onLongPress={this.handleLongPressWithIndex.get(index)}\n          onClick={this.handleClick}\n          onDoubleClick={this.handleDoubleClick}\n          enableSwipeDown={this.props.enableSwipeDown}\n          swipeDownThreshold={this.props.swipeDownThreshold}\n          onSwipeDown={this.handleSwipeDown}\n          pinchToZoom={this.props.enableImageZoom}\n          enableDoubleClickZoom={this.props.enableImageZoom}\n          doubleClickInterval={this.props.doubleClickInterval}\n          {...others}\n        >\n          {children}\n        </ImageZoom>\n      );\n\n      switch (imageInfo.status) {\n        case 'loading':\n          return (\n            <Wrapper\n              key={index}\n              style={{\n                ...this.styles.modalContainer,\n                ...this.styles.loadingContainer,\n              }}\n              imageWidth={screenWidth}\n              imageHeight={screenHeight}\n            >\n              <View style={this.styles.loadingContainer}>\n                {this!.props!.loadingRender!()}\n              </View>\n            </Wrapper>\n          );\n        case 'success':\n          if (!image.props) {\n            image.props = {};\n          }\n\n          if (!image.props.style) {\n            image.props.style = {};\n          }\n          image.props.style = {\n            ...this.styles.imageStyle, // User config can override above.\n            ...image.props.style,\n            width,\n            height,\n          };\n\n          if (typeof image.props.source === 'number') {\n            // source = require(..), doing nothing\n          } else {\n            if (!image.props.source) {\n              image.props.source = {};\n            }\n            image.props.source = {\n              uri: image.url,\n              ...image.props.source,\n            };\n          }\n          if (this.props.enablePreload) {\n            this.preloadImage(this.state.currentShowIndex || 0);\n          }\n          return (\n            <ImageZoom\n              key={index}\n              ref={(el) => (this.imageRefs[index] = el)}\n              cropWidth={this.width}\n              cropHeight={this.height}\n              maxOverflow={this.props.maxOverflow}\n              horizontalOuterRangeOffset={this.handleHorizontalOuterRangeOffset}\n              responderRelease={this.handleResponderRelease}\n              onMove={this.props.onMove}\n              onLongPress={this.handleLongPressWithIndex.get(index)}\n              onClick={this.handleClick}\n              onDoubleClick={this.handleDoubleClick}\n              imageWidth={width}\n              imageHeight={height}\n              enableSwipeDown={this.props.enableSwipeDown}\n              swipeDownThreshold={this.props.swipeDownThreshold}\n              onSwipeDown={this.handleSwipeDown}\n              panToMove={!this.state.isShowMenu}\n              pinchToZoom={this.props.enableImageZoom && !this.state.isShowMenu}\n              enableDoubleClickZoom={\n                this.props.enableImageZoom && !this.state.isShowMenu\n              }\n              doubleClickInterval={this.props.doubleClickInterval}\n              minScale={this.props.minScale}\n              maxScale={this.props.maxScale}\n            >\n              {this!.props!.renderImage!(image.props)}\n            </ImageZoom>\n          );\n        case 'fail':\n          return (\n            <Wrapper\n              key={index}\n              style={this.styles.modalContainer}\n              imageWidth={\n                this.props.failImageSource\n                  ? this.props.failImageSource.width\n                  : screenWidth\n              }\n              imageHeight={\n                this.props.failImageSource\n                  ? this.props.failImageSource.height\n                  : screenHeight\n              }\n            >\n              {this.props.failImageSource &&\n              this!.props!.renderImage!({\n                source: {\n                  uri: this.props.failImageSource.url,\n                },\n                style: {\n                  width: this.props.failImageSource.width,\n                  height: this.props.failImageSource.height,\n                },\n              })}\n            </Wrapper>\n          );\n      }\n    });\n\n    return (\n      <Animated.View style={{ zIndex: 9 }}>\n        <Animated.View\n          style={{ ...this.styles.container, opacity: this.fadeAnim }}\n        >\n          {this!.props!.renderHeader!(this.state.currentShowIndex)}\n\n          <View style={this.styles.arrowLeftContainer}>\n            <TouchableWithoutFeedback onPress={this.goBack}>\n              <View>{this!.props!.renderArrowLeft!()}</View>\n            </TouchableWithoutFeedback>\n          </View>\n\n          <View style={this.styles.arrowRightContainer}>\n            <TouchableWithoutFeedback onPress={this.goNext}>\n              <View>{this!.props!.renderArrowRight!()}</View>\n            </TouchableWithoutFeedback>\n          </View>\n\n          <Animated.View\n            style={{\n              ...this.styles.moveBox,\n              transform: [{ translateX: this.positionX }],\n              width: this.width * this.props.imageUrls.length,\n              height: this.height,\n            }}\n          >\n            {ImageElements}\n          </Animated.View>\n          {this!.props!.renderIndicator!(\n            (this.state.currentShowIndex || 0) + 1,\n            this.props.imageUrls.length,\n          )}\n\n          {this.props.imageUrls[this.state.currentShowIndex || 0] &&\n          this.props.imageUrls[this.state.currentShowIndex || 0]\n            .originSizeKb &&\n          this.props.imageUrls[this.state.currentShowIndex || 0]\n            .originUrl && (\n            <View style={this.styles.watchOrigin}>\n              <TouchableOpacity style={this.styles.watchOriginTouchable}>\n                <Text style={this.styles.watchOriginText}>查看原图(2M)</Text>\n              </TouchableOpacity>\n            </View>\n          )}\n          <View\n            style={[\n              { bottom: 0, position: 'absolute', zIndex: 9 },\n              this.props.footerContainerStyle,\n            ]}\n          >\n            {this!.props!.renderFooter!(this.state.currentShowIndex || 0)}\n          </View>\n        </Animated.View>\n      </Animated.View>\n    );\n  }\n\n  /**\n   * 保存当前图片到本地相册\n   */\n  public saveToLocal = () => {\n    if (!this.props.onSave) {\n      CameraRoll.saveToCameraRoll(\n        this.props.imageUrls[this.state.currentShowIndex || 0].url,\n      );\n      this!.props!.onSaveToCamera!(this.state.currentShowIndex);\n    } else {\n      this.props.onSave(\n        this.props.imageUrls[this.state.currentShowIndex || 0].url,\n      );\n    }\n\n    this.setState({ isShowMenu: false });\n  };\n\n  public getMenu() {\n    if (!this.state.isShowMenu) {\n      return null;\n    }\n\n    if (this.props.menus) {\n      return (\n        <View style={this.styles.menuContainer}>\n          {this.props.menus({\n            cancel: this.handleLeaveMenu,\n            saveToLocal: this.saveToLocal,\n          })}\n        </View>\n      );\n    }\n\n    return (\n      <View style={this.styles.menuContainer}>\n        <View style={this.styles.menuShadow} />\n        <View style={this.styles.menuContent}>\n          <TouchableHighlight\n            underlayColor='#F2F2F2'\n            onPress={this.saveToLocal}\n            style={this.styles.operateContainer}\n          >\n            <Text style={this.styles.operateText}>\n              {this.props.menuContext.saveToLocal}\n            </Text>\n          </TouchableHighlight>\n          <TouchableHighlight\n            underlayColor='#F2F2F2'\n            onPress={this.handleLeaveMenu}\n            style={this.styles.operateContainer}\n          >\n            <Text style={this.styles.operateText}>\n              {this.props.menuContext.cancel}\n            </Text>\n          </TouchableHighlight>\n        </View>\n      </View>\n    );\n  }\n\n  public handleLeaveMenu = () => {\n    this.setState({ isShowMenu: false });\n  };\n\n  public handleSwipeDown = () => {\n    if (this.props.onSwipeDown) {\n      this.props.onSwipeDown();\n    }\n    this.handleCancel();\n  };\n\n  public render() {\n    let childs: React.ReactElement<any> = null as any;\n\n    childs = (\n      <View style={{ flex: 1, height: '100%' }}>\n        {this.getContent()}\n        {this.getMenu()}\n      </View>\n    );\n\n    return (\n      <View\n        onLayout={this.handleLayout}\n        style={{\n          flex: 1,\n          overflow: 'hidden',\n          ...this.props.style,\n        }}\n      >\n        {childs}\n      </View>\n    );\n  }\n}\n"]}